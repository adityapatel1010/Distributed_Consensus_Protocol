syntax = "proto3";

package msg;

message Heartbeat {
  string type = 1;     // "heartbeat", "prepare", "accept", etc.
  int32 sender_id = 2;
}

message Ack {
  string type=1;
  int32 seq_num=2;
  int32 sender_id=3;
}

message Command {
  string type=1;
  int32 seq_num=2;
}

message Clients {
  string c1=1;
  string c2=2;
}

message Transaction {
  Clients c=1;
  int32 amt=2;
  int32 unique=3;
}

message Ballot {
  int32 ballot_num=1;
  int32 sender_id=2;
}

message LogMsg {
  Ballot b=1;
  int32 seq_num=2;
  Transaction tns=3;
}

message Prepare {
  string type=1;
  Ballot b=2;
}

message Acknowledge {
    bool vote = 1;
    Ballot b=2;
    repeated LogMsg log=3;
}

message NewLogView {
  Ballot b=1;
  repeated LogMsg log=2;
}

message Accept {
  Ballot b=1;
  int32 seq_num=2;
  Transaction tns=3;
}

message Accepted {
  Ballot b=1;
  int32 seq_num=2;
  Transaction tns=3;
  int32 sender_id=4;
}

message Commit {
  Ballot b=1;
  int32 seq_num=2;
  Transaction tns = 3;
}

message ClientTransaction {
  Transaction tns=1;
  int32 c1=2;
  int32 unique=3;
  string msg=4;
}

message TransCompleted {
  Ballot b=1;
  int32 c1=2;
  int32 unique=3;
  int32 sender_id=4;
  bool r=5;
}

message TransAck {
  int32 leader=1;
  int32 unique=2;
}

service NodeService {
  rpc SendPrepare(Prepare) returns (Acknowledge);
  rpc SendNewLogView(NewLogView) returns (stream Accepted);
  rpc SendAccept(Accept) returns (Accepted);
  rpc SendCommit(Commit) returns (Ack);
  rpc SendHeartbeat(Heartbeat) returns (Ack);
  rpc ActionCommand(Command) returns (Ack);
  rpc SendClientTransaction(ClientTransaction) returns (TransAck);
  rpc SendTransCompleted(TransCompleted) returns (Ack);
}